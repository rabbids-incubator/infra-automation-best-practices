# Infrastructure automation best practices

[![GitLab Pipeline Status](https://gitlab.com/rabbids-incubator/infra-automation-best-practices/badges/main/pipeline.svg)](https://gitlab.com/rabbids-incubator/infra-automation-best-practices/-/pipelines)

This is the codebase of [rabbids-incubator.gitlab.io/infra-automation-best-practices](https://rabbids-incubator.gitlab.io/infra-automation-best-practices) which presents a set of best practices to automate an infrastructure through IaC. The presentation is generated by [Marp](https://marp.app/).

## How to build

* Make sure [Node.js](https://nodejs.org/en/download/) is installed

```bash
npm -v
```

* Install [`marp-cli`](https://github.com/marp-team/marp-cli) NPM package (install [Node.js](https://nodejs.org/en/download/) if NPM is an unknown command)

```bash
npm install -g @marp-team/marp-cli
```

* Build HTML output

```bash
marp docs/*.md
```

* Open [index.html](./docs/index.html)

## How to contribute

* Fork this repository
* Build the solution

```bash
marp docs/*.md
```

* Start watching the changes on the file you're going to edit
  
  ```bash
  marp docs/index.md --watch
  ```

* Make a change in `docs` folder and see directly the result on [index.html](./docs/index.html)
* Commit the changes and push to your repository
* Submit a Pull Request

## How to publish

This is done automatically by the GitLab CI pipeline, which is defined in [.gitlab-ci.yml](./.gitlab-ci.yml).

## How to run locally the pipeline

```bash
# creates local folder
mkdir -p .gitlab/runner/local

# runs ci job
docker run --rm --name gitlab-runner -v /var/run/docker.sock:/var/run/docker.sock -v $PWD/.gitlab/runner/local/config:/etc/gitlab-runner -v $PWD:$PWD --workdir $PWD gitlab/gitlab-runner exec docker ci

# runs pages job
docker run --rm --name gitlab-runner -v /var/run/docker.sock:/var/run/docker.sock -v $PWD/.gitlab/runner/local/config:/etc/gitlab-runner -v $PWD:$PWD --workdir $PWD gitlab/gitlab-runner exec docker pages
```
